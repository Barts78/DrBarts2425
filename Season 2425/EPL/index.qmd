---
title: "Dr Barts"
subtitle: "Match Day"
image: Images/Social_profile.png

format:
  html:
    theme:
      - litera
      - Matchdash.scss
    page-layout: full
---

:::::: hero
:::: hero-text
# Dr Barts

<p class="hero-kicker">

Football Stats Hub

</p>

<p class="hero-blurb">

I am a part time football analyst specialising in the Quarto and R ecosystems.

</p>

::: hero-links
<a class="hero-link" href="https://github.com/Barts78"><i class="bi bi-github"></i></a> <a class="hero-link" href="https://twitter.com/Barts78"><i class="bi bi-twitter"></i></a> <a class="hero-link" href="https://www.linkedin.com/in/phil-barter-55500122/"><i class="bi bi-linkedin"></i></a> <a class="hero-link" href="https://bsky.app/profile/barts78.bsky.social"><i class="bi bi-bluesky"></i></a>
:::
::::

::: hero-portrait
![](Images/Social_profile.png){.hero-avatar}
:::
::::::

:::: bio-card
::: bio-title
<b>Bio</b>
:::

This is a home for my football visualisation work across **AI UP** and **TMM** pods.

EPL Games for the **2024 - 2025** Season
::::
## Browse by Match Day


```{r}
#| echo: false
#| message: false
#| results: asis

base_dir <- "."

md_dirs <- list.dirs(base_dir, recursive = FALSE, full.names = FALSE)
md_dirs <- md_dirs[grepl("^MD\\s+\\d+$", md_dirs)]
md_dirs <- md_dirs[order(as.numeric(sub("^MD\\s+", "", md_dirs)))]

default_thumb <- "Images/Premier-League-ball.png"

pick_md_thumb <- function(md, base_dir = ".") {

  # extract MD number (e.g. "MD 12" -> 12)
  md_num <- sub("^MD\\s+", "", md)

  thumb_path <- file.path(
    base_dir,
    md,
    #"docs",
    paste0("Match-day-", md_num, "-Dashboard_files"),
    "figure-html",
    "Match Result Probablity Plot-1.png"
  )

  thumb_path <- gsub("\\\\", "/", thumb_path)

  if (file.exists(thumb_path)) {
    thumb_path
  } else {
    "Images/Premier-League-ball.png"   # fallback
  }
}

# Extract a nice subtitle from the HTML itself
extract_subtitle <- function(html_path) {
  x <- tryCatch(readLines(html_path, warn = FALSE, encoding = "UTF-8"), error = function(e) character(0))
  if (!length(x)) return("Open matchday dashboard")

  txt <- paste(x, collapse = "\n")

  # 1) <title>...</title>
  m <- regexpr("(?is)<title>\\s*([^<]+?)\\s*</title>", txt, perl = TRUE)
  if (m[1] != -1) {
    title <- sub("(?is).*<title>\\s*([^<]+?)\\s*</title>.*", "\\1", regmatches(txt, m), perl = TRUE)

    # Clean common suffixes
    title <- gsub("\\s*\\|\\s*.*$", "", title)         # remove "| Site Name"
    title <- gsub("\\s*-\\s*Quarto$", "", title)       # remove "- Quarto"
    title <- trimws(title)

    if (nzchar(title)) return(title)
  }

  # 2) Fallback: first <h1>...</h1>
  m2 <- regexpr("(?is)<h1[^>]*>\\s*([^<]+?)\\s*</h1>", txt, perl = TRUE)
  if (m2[1] != -1) {
    h1 <- sub("(?is).*<h1[^>]*>\\s*([^<]+?)\\s*</h1>.*", "\\1", regmatches(txt, m2), perl = TRUE)
    h1 <- trimws(h1)
    if (nzchar(h1)) return(h1)
  }

  "Open matchday dashboard"
}

cards <- vapply(md_dirs, function(md) {

  docs_dir <- file.path(base_dir, md)
  if (!dir.exists(docs_dir)) return(NA_character_)

  html_files <- list.files(docs_dir, pattern = "\\.html$", full.names = FALSE)
  if (length(html_files) == 0) return(NA_character_)

  html_file <- sort(html_files)[1]

  # Link URL (relative)
  rel_path <- file.path(md, html_file)
  rel_path <- gsub("\\\\", "/", rel_path)
  url <- utils::URLencode(rel_path)

  # Subtitle from HTML contents
  full_html_path <- file.path(docs_dir, html_file)
  subtitle <- extract_subtitle(full_html_path)

  thumb <- pick_md_thumb(md)

  sprintf(
    paste0(
      '<div class="g-col-12 g-col-md-6 g-col-lg-4">\n',
      '  <div class="card season-card">\n',
      '    <div class="season-card-media">\n',
      '      <img src="%s" class="card-img-top img-fluid" alt="%s thumbnail">\n',
      '    </div>\n',
      '    <div class="card-body">\n',
      '      <h3><a href="%s">%s</a></h3>\n',
      '      <div class="text-muted">%s</div>\n',
      '    </div>\n',
      '  </div>\n',
      '</div>\n'
    ),
    thumb, md, url, md, htmltools::htmlEscape(subtitle)
  )
}, character(1))

cards <- cards[!is.na(cards)]

output <- paste0(
  '<div class="grid">\n',
  paste(cards, collapse = "\n"),
  "\n</div>\n"
)

knitr::asis_output(output)
```


<!--

- [MD 1](MD%201/docs/Match%20day%201%20Dashboard.html)
- [MD 2](MD%202/docs/Match%20day%202%20Dashboard.html)
- [MD 3](MD%203/docs/Match%20day%203%20Dashboard.html)
- [MD 4](MD%204/docs/Match%20day%204%20Dashboard.html)
- [MD 5](MD%205/docs/Match%20day%205%20Dashboard.html)
- [MD 6](MD%206/docs/Match%20day%206%20Dashboard.html)
- [MD 7](MD%207/docs/Match%20day%207%20Dashboard.html)
- [MD 8](MD%208/docs/Match%20day%208%20Dashboard.html)
- [MD 9](MD%209/docs/Match%20day%209%20Dashboard.html)
- [MD 10](MD%2010/docs/Match%20day%2010%20Dashboard.html)
- [MD 11](MD%2011/docs/Match%20day%2011%20Dashboard.html)
- [MD 12](MD%2012/docs/Match%20day%2012%20Dashboard.html)
- [MD 13](MD%2013/docs/Match%20day%2013%20Dashboard.html)
- [MD 14](MD%2014/docs/Match%20day%2014%20Dashboard.html)
- [MD 15](MD%2015/docs/Match%20day%2015%20Dashboard.html)
- [MD 16](MD%2016/docs/Match%20day%2016%20Dashboard.html)
- [MD 17](MD%2017/docs/Match%20day%2017%20Dashboard.html)
- [MD 18](MD%2018/docs/Match%20day%2018%20Dashboard.html)
- [MD 19](MD%2019/docs/Match%20day%2019%20Dashboard.html)
- [MD 20](MD%2020/docs/Match%20day%2020%20Dashboard.html)
- [MD 21](MD%2021/docs/Match%20day%2021%20Dashboard.html)
- [MD 22](MD%2022/docs/Match%20day%2022%20Dashboard.html)
- [MD 23](MD%2023/docs/Match%20day%2023%20Dashboard.html)

-->
